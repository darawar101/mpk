<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NGO Dashboard - Justice for All</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.3/flowbite.min.js"></script>
    <link rel="icon" type="image/png" href="Adobe Express - file (1) (1).png">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        @media (max-width: 640px) {
            .filter-container {
                flex-direction: column;
                align-items: center;
            }

            .filter-container select,
            .filter-container input,
            .filter-container button {
                width: 100%;
                max-width: 300px;
            }

            .responsive-name {
                font-size: 1.20rem !important;
            }
        }

        body {
            background: url("Background.jpg") no-repeat center center fixed;
            background-size: cover;
            color: white;
            font-family: 'Inter', sans-serif;
            position: relative;
        }

        body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(20, 30, 48, 0.8);
            /* Dark overlay to improve text readability */
            z-index: -1;
        }

        .table-container table {
            background: rgba(30, 30, 30, 0.9);
            /* Darker background for better contrast */
            color: white;
            border-collapse: collapse;
        }

        .table-container th {
            background: rgba(50, 50, 50, 0.9);
            /* Darker header */
            color: white;
        }

        .table-container td {
            background: rgba(40, 40, 40, 0.8);
            /* Slightly lighter than the header */
            color: white;
            border: 1px solid rgba(100, 100, 100, 0.5);
        }

        .table-container tr:hover {
            background: rgba(70, 70, 70, 0.9);
            /* Highlight row on hover */
        }
        td:nth-child(2), th:nth-child(2) { 
    min-width: 120px; /* Adjust width as needed */
    text-align: center; /* Center align for better readability */
}

    </style>
</head>

<body class="bg-gray-900 text-white">
    <div class="m-nav ">
        <div class="wrapper mt-10">
            <!-- Navigation bar with radio buttons for tab functionality -->
            <nav>
                <!-- Home tab (default selected) -->
                <input type="radio" name="tab" id="home" checked>
                <!-- Inbox tab -->
                <input type="radio" name="tab" id="inbox">
                <!-- Contact tab -->
                <input type="radio" name="tab" id="contact">
                <!-- Heart tab -->
                <input type="radio" name="tab" id="heart">
                <!-- About tab -->
                <input type="radio" name="tab" id="about">

                <!-- Labels with icons and links for each tab -->
                <label for="home" class="home">
                    <a href="index.html" id="homeLink"><i class="fas fa-home"></i>Home</a>
                </label>
                <label for="inbox" class="inbox">
                    <a href="https://docs.google.com/spreadsheets/d/1GAuXwfN3L7Gdbyn7RXP4sWImIwo72T7xgDBN1Uw7vTs/edit?usp=sharing"
                        target="_blank">
                        <i class="fas fa-file-excel"></i> Sheet
                    </a>
                </label>




                <label for="contact" class="contact">
                    <a href="stats.html" id="statsLink"><i class="fas fa-chart-pie"></i>Stats</a>
                </label>


                <label for="heart" class="heart">
                    <a href="dashboard.html" id="dashboardLink"><i class="fas fa-tachometer-alt"></i>Dashboard</a>
                </label>


                <label for="about" class="about">
                    <a href="user-guide.html" id="userGuideLink"><i class="fa fa-book"></i>User Guide</a>
                </label>

                <!-- Tab indicator for the elastic animation -->
                <div class="tab"></div>

            </nav>
        </div>
    </div>

    <section class="p-10 text-center">
        <h2 class="text-3xl font-bold">Case Reports</h2>
        <div class="flex flex-wrap justify-center mt-6 gap-4 filter-container">
            <select id="crimeType" class="text-black p-2 rounded w-full sm:w-auto">
                <option value="">All Crimes</option>
                <option value="Kidnap">Kidnap</option>
                <option value="Force Conversion">Force Conversion</option>
                <option value="Suicide">Suicide</option>
                <option value="Murder">Murder</option>
                <option value="Child Marriage">Child Marriage</option>
                <option value="Land Grabber">Land Grabber</option>
                <option value="Others">Others</option>
            </select>
            <input type="date" id="dateFilter" class="text-black p-2 rounded w-full sm:w-auto">
            <select id="genderFilter" class="text-black p-2 rounded w-full sm:w-auto">
                <option value="">All Genders</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
            </select>
            <input type="text" id="nameFilter" placeholder="Search by Name"
                class="text-black p-2 rounded w-full sm:w-auto" />
            <button onclick="filterData()" class="bg-blue-500 p-2 rounded w-full sm:w-auto">Filter</button>
            <button onclick="downloadCSV()" class="bg-green-500 p-2 rounded w-full sm:w-auto">Download CSV</button>
        </div>

        <div class="table-container overflow-auto mt-6">
            <table class="w-full text-left border border-gray-700">
                <thead>
                    <tr class="bg-gray-700">
                        <th class="p-2">Timestamp</th>
                        <th class="p-2">Date</th>
                        <th class="p-2">Day</th>
                        <th class="p-2">Time</th>
                        <th class="p-2">Victim Name</th>
                        <th class="p-2">Case Picture</th>
                        <th class="p-2">Gender</th>
                        <th class="p-2">Religion</th>
                        <th class="p-2">Location</th>
                        <th class="p-2">Case Description</th>
                    </tr>
                </thead>
                <tbody id="reportTable"></tbody>
            </table>
        </div>
    </section>

    <script>
        let allData = [];
        async function fetchData() {
            const sheetID = "1GAuXwfN3L7Gdbyn7RXP4sWImIwo72T7xgDBN1Uw7vTs";
            const apiKey = "AIzaSyD2A2M4nM0_mUyPopG-9d3_piiljHgCq58";
            const sheetNames = ["Others Cases", "Land Grabber", "Child Marrige", "Murder", "Sucide", "Force Conversion", "Kidnap"];
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetID}/values:batchGet?${sheetNames.map(name => `ranges=${encodeURIComponent(name)}`).join("&")}&key=${apiKey}`;
            try {
                const response = await fetch(url);
                const json = await response.json();
                allData = [];
                json.valueRanges.forEach((sheet, index) => {
                    if (sheet.values) {
                        const headers = sheet.values[0].map(header => header.trim());
                        const rows = sheet.values.slice(1);
                        rows.forEach(row => {
                            let rowData = {};
                            headers.forEach((header, i) => {
                                rowData[header] = row[i] ? row[i].trim() : "";
                            });
                            rowData["Crime Type"] = sheetNames[index];
                            allData.push(rowData);
                        });
                    }
                });
                displayData(allData);
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }

        function formatDateForDisplay(dateString) {
    if (!dateString) return "";

    const parts = dateString.split("/");
    if (parts.length === 3) {
        const mm = parts[0].padStart(2, '0'); // Month
        const dd = parts[1].padStart(2, '0'); // Day
        const yyyy = parts[2]; // Year

        return `${dd}/${mm}/${yyyy}`; // Convert to DD/MM/YYYY format
    }
    return dateString;
}


function displayData(data) {
    const table = document.getElementById("reportTable");
    table.innerHTML = "";

    // Sort data by date (latest first)
    data.sort((a, b) => {
        const dateA = new Date(convertDateFormat(a["Date"]));
        const dateB = new Date(convertDateFormat(b["Date"]));
        return dateB - dateA; // Descending order
    });

    data.forEach(row => {
        let imageUrl = row["Case Picture"];
        let formattedDate = formatDateForDisplay(row["Date"]); // Convert to DD/MM/YYYY

        table.innerHTML += `<tr class='border border-gray-700'>
            <td class='p-2'>${row.Timestamp}</td>
            <td class='p-2'>${formattedDate}</td> <!-- Display formatted date -->
            <td class='p-2'>${row.Day}</td>
            <td class='p-2'>${row.Time}</td>
            <td class='p-2'>${row["Victim Name"]}</td>
            <td class='p-2'><a href='${imageUrl}' target='_blank' class='bg-blue-500 text-white px-3 py-1 rounded'>Image</a></td>
            <td class='p-2'>${row.Gender}</td>
            <td class='p-2'>${row.Religion}</td>
            <td class='p-2'>${row.Location}</td>
            <td class='p-2'>${row["Case Description"]}</td>
        </tr>`;
    });
}

function displayLatestCase(data) {
    const table = document.getElementById("reportTable");
    table.innerHTML = "";

    if (data.length === 0) return;

    // Sort data by date (latest first)
    data.sort((a, b) => {
        const dateA = new Date(convertDateFormat(a["Date"]));
        const dateB = new Date(convertDateFormat(b["Date"]));
        return dateB - dateA; // Descending order
    });

    // Get the latest case (first entry after sorting)
    const latestCase = data[0];

    let imageUrl = latestCase["Case Picture"];
    let formattedDate = formatDateForDisplay(latestCase["Date"]); // Convert to DD/MM/YYYY

    table.innerHTML += `<tr class='border border-gray-700'>
        <td class='p-2'>${latestCase.Timestamp}</td>
        <td class='p-2'>${formattedDate}</td> <!-- Display formatted date -->
        <td class='p-2'>${latestCase.Day}</td>
        <td class='p-2'>${latestCase.Time}</td>
        <td class='p-2'>${latestCase["Victim Name"]}</td>
        <td class='p-2'><a href='${imageUrl}' target='_blank' class='bg-blue-500 text-white px-3 py-1 rounded'>Image</a></td>
        <td class='p-2'>${latestCase.Gender}</td>
        <td class='p-2'>${latestCase.Religion}</td>
        <td class='p-2'>${latestCase.Location}</td>
        <td class='p-2'>${latestCase["Case Description"]}</td>
    </tr>`;
}



        function convertDateFormat(dateString) {
    // Check if the date string is valid
    if (!dateString) return "";

    const parts = dateString.split("/");
    if (parts.length === 3) {
        return `${parts[2]}-${parts[1]}-${parts[0]}`; // Convert MM/DD/YYYY to YYYY-MM-DD
    }
    return dateString;
}

function convertDateFormat(dateString) {
    if (!dateString) return "";

    const parts = dateString.split("/"); // Assuming MM/DD/YYYY format
    if (parts.length === 3) {
        const mm = parts[0].padStart(2, '0'); // Ensure two-digit month
        const dd = parts[1].padStart(2, '0'); // Ensure two-digit day
        const yyyy = parts[2];

        return `${yyyy}-${mm}-${dd}`; // Convert to YYYY-MM-DD
    }
    return dateString; // Return unchanged if format is incorrect
}

function filterData() {
    const crimeType = document.getElementById("crimeType").value;
    const dateFilter = document.getElementById("dateFilter").value; // YYYY-MM-DD format
    const genderFilter = document.getElementById("genderFilter").value;
    const nameFilter = document.getElementById("nameFilter").value.toLowerCase();

    let filteredData = allData.filter(row => {
        let rowCrimeType = row["Crime Type"];
        if (rowCrimeType === "Sucide") rowCrimeType = "Suicide"; // Normalize typo

        let rowDate = convertDateFormat(row["Date"]); // Convert MM/DD/YYYY to YYYY-MM-DD

        let matchesCrime = crimeType === "" || rowCrimeType === crimeType;
        let matchesDate = dateFilter === "" || rowDate === dateFilter;
        let matchesGender = genderFilter === "" || row["Gender"] === genderFilter;
        let matchesName = nameFilter === "" || (row["Victim Name"] && row["Victim Name"].toLowerCase().includes(nameFilter));

        return matchesCrime && matchesDate && matchesGender && matchesName;
    });

    displayData(filteredData);
}






        function downloadCSV() {
            let csvContent = "data:text/csv;charset=utf-8,"
                + "Timestamp,Date,Day,Time,Victim Name,Case Picture,Gender,Religion,Location,Case Description\n";

            allData.forEach(row => {
                csvContent += `${row.Timestamp},${row.Date},${row.Day},${row.Time},${row["Victim Name"]},${row["Case Picture"]},${row.Gender},${row.Religion},${row.Location},${row["Case Description"]}\n`;
            });

            let encodedUri = encodeURI(csvContent);
            let link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "case_reports.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }


        fetchData();
    </script>
    <script src="nav-script.js"></script>
</body>

</html>